
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Signup</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --black:#000; --gray:#666; --border:#e5e5e5;
}
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;height:100vh;display:flex;align-items:center;justify-content:center;
}
.container{width:380px;text-align:center}
h1{margin-bottom:6px}
p{color:var(--gray);font-size:14px}
input,button{
  width:100%;padding:16px;margin-top:12px;
  border-radius:30px;border:1px solid var(--border);
  font-size:14px;
}
button{cursor:pointer}
button.primary{background:#000;color:#fff;border:none}
button[disabled], button.primary[disabled] {
  background: #6b6b6b !important;
  color: #aaa !important;
  border: 1px solid var(--border) !important;
  cursor: not-allowed !important;
}
button:hover{background:#f5f5f5}
button.primary:hover:not([disabled]){background:#191919}
.toast-box {
  position: fixed;
  top: 30px;
  right: 30px;
  z-index: 9999;
  min-width: 300px;
  max-width: 90vw;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  pointer-events: none;
}
.toast {
  pointer-events: auto;
  background: #23272f;
  color: #fff;
  padding: 15px 28px;
  margin-bottom: 14px;
  border-radius: 14px;
  min-width: 240px;
  font-size: 15px;
  box-shadow: 0 1px 10px 2px rgba(0,0,0,0.06);
  opacity: 0;
  transform: translateY(-10px);
  animation: slidein 0.25s forwards;
}
.toast.success {
  background: #4BB543;
}
.toast.error {
  background: #ff4d4f;
}
@keyframes slidein {
  to {
    opacity: 1;
    transform: none;
  }
}
</style>
</head>

<body>

<div class="container">
  <h1>Create account</h1>
  <p>Sign up to continue</p>

  <form id="signupForm" action="/signup" method="post" style="display:flex;flex-direction:column;">
    <input id="username" name="username" placeholder="Username" oninput="updateSignupButton()">
    <input id="email" name="email" type="email" placeholder="Email" oninput="updateSignupButton()">
    <input id="first" name="first" placeholder="First name" oninput="updateSignupButton()">
    <input id="last" name="last" placeholder="Last name (optional)">
    <input id="password" name="password" type="password" placeholder="Password" oninput="updateSignupButton()">
    <input id="age" name="age" placeholder="Age (optional)">
    <input id="role" name="role" placeholder="Role (optional)">

    <button class="primary" id="signupBtn" type="button" onclick="signup()" disabled>Create account</button>
    <button type="button" onclick="location.href='/login'">Back to login</button>
  </form>
</div>
<div class="toast-box" id="toast-box"></div>

<div id="server-error" style="display:none; position:fixed; top:18px; left:18px; z-index:99999; background:#ff4d4f; color:#fff; padding:12px 16px; border-radius:10px; max-width:90vw; box-shadow:0 6px 18px rgba(0,0,0,0.2);"></div>

<script>

function showToast(msg, type="success", cb=null) {
  const toastBox = document.getElementById('toast-box');
  while (toastBox.firstChild) toastBox.removeChild(toastBox.firstChild);
  const toast = document.createElement('div');
  toast.className = 'toast ' + type;
  toast.innerText = msg;
  toastBox.appendChild(toast);
  setTimeout(()=>{
    toast.style.opacity='0';
    toast.style.transform = 'translateY(-10px)';
    setTimeout(()=>{
      toast.remove();
      if(typeof cb === "function") cb();
    },350);
  }, 2200);
}

function requiredFieldsFilled() {
  return (
    document.getElementById('username').value.trim() &&
    document.getElementById('email').value.trim() &&
    document.getElementById('first').value.trim() &&
    document.getElementById('password').value.trim()
  );
}

function updateSignupButton() {
  const btn = document.getElementById('signupBtn');
  btn.disabled = !requiredFieldsFilled();
}

function isEmailValid(emailValue) {
  if (!emailValue.includes("@") || !emailValue.includes(".")) {
    return false;
  }
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailPattern.test(emailValue);
}

async function signup(){
  const userVal = username.value.trim();
  const emailVal = email.value.trim();
  const firstVal = first.value.trim();
  const pwdVal = password.value.trim();

  if(!userVal || !emailVal || !firstVal || !pwdVal){
    showToast("Please fill in all required fields.","error");
    updateSignupButton();
    return;
  }

  if (!emailVal.includes("@") || !emailVal.includes(".")) {
    showToast("Invalid Email", "error");
    updateSignupButton();
    return;
  }
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if(!emailPattern.test(emailVal)) {
    showToast("Please enter a valid email address.", "error");
    updateSignupButton();
    return;
  }

  const form = document.getElementById('signupForm');
  showToast("Creating account...", "success");
  form.submit();
}


window.addEventListener('DOMContentLoaded', updateSignupButton);
function showServerErrorFromQuery() {
  try {
    const params = new URLSearchParams(window.location.search);
    const err = params.get('error');
    if (err) {
      const box = document.getElementById('server-error');
      box.innerText = decodeURIComponent(err);
      box.style.display = 'block';
      const url = new URL(window.location);
      url.searchParams.delete('error');
      window.history.replaceState({}, '', url.toString());
    }
  } catch (e) {}
}
showServerErrorFromQuery();
</script>

<script>
(function(){
  function _block(e){e.preventDefault();e.stopPropagation();}
  document.addEventListener('contextmenu', _block, true);
  document.addEventListener('keydown', function(e){
    if (e.key === 'F12' || e.keyCode === 123 ||
        (e.ctrlKey && e.shiftKey && /[IJC]/i.test(e.key)) ||
        (e.ctrlKey && e.key && e.key.toUpperCase() === 'U')) {
      _block(e);
    }
  }, true);
})();
</script>

</body>

<style>
  ::selection {
    background: #ababab;
    color: #1f1f1f;
  }
  </style>
</html>
